{% load kershner_tags %}

{% block extra_head %}
  <link rel="stylesheet" href="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/css/leaflet.css" />
  <link rel="stylesheet" href="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/css/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/css/MarkerCluster.css" />
  <link rel="stylesheet" href="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/css/Control.FullScreen.css" />

  <script type="text/javascript" src="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/js/leaflet.js"></script>
  <script type="text/javascript" src="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/js/leaflet.markercluster.js"></script>
  <script type="text/javascript" src="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/js/Control.FullScreen.js"></script>

  <script>
    window.daggerwalkMap = {
      imageUrl: "{% settings_value "BASE_S3_URL" %}/img/daggerwalk/world_map_stitched_native.png"
    };
  </script>
{% endblock %}

<div class="map-container">
  {# Map filter controls #}
  <div id="filters">
    <label><input type="checkbox" id="toggle-logs" checked> Logs</label>
    <select id="log-date-filter">
      <option value="thisweek" selected>This Week</option>
      <option value="lastweek">Last Week</option>
      <option value="today">Today</option>
      <option value="yesterday">Yesterday</option>
      <option value="all">Last 2 Weeks</option>
    </select>
    <label><input type="checkbox" id="toggle-quest" checked> Quest</label>
    <label><input type="checkbox" id="toggle-pois"> POIs</label>
    <label><input type="checkbox" id="toggle-shapes"> Labels</label>
    
    <button id="refresh-map">Refresh</button>
  </div>

  {# Leaflet map container #}
  <div id="map"></div>
</div>

{# Data elements used by JS #}
{{ logs_json|json_script:"logs-data" }}
{{ poi_json|json_script:"poi-data" }}
{{ quest_json|json_script:"quest-data" }}
{{ shape_data|json_script:"shape-data" }}

{% include "daggerwalk/map_marker_popup.html" %}