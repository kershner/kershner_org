{% load kershner_tags %}

{% block extra_head %}
  <link rel="stylesheet" href="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/css/leaflet.css" />
  <link rel="stylesheet" href="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/css/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/css/MarkerCluster.css" />

  <script type="text/javascript" src="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/js/leaflet.js"></script>
  <script type="text/javascript" src="{% settings_value "BASE_S3_URL" %}/vendor/leaflet/js/leaflet.markercluster.js"></script>

  <script>
    window.daggerwalkMap = {
      imageUrl: "{% settings_value "BASE_S3_URL" %}/img/daggerwalk/world_map_stitched_native.png"
    };
  </script>
{% endblock %}

<div class="map-container">
  {# Leaflet map container #}
  <div id="map">
    {# Map filter controls #}
    <div id="filters">
      <button id="refresh-map" title="Refresh map data">↻</button>
      
      <select id="log-type-filter">
        <option value="logs" selected>Default</option>
        <option value="terrain">Terrain</option>
        <option value="weather">Weather</option>
        <option value="season">Season</option>
        <option value="hidden">Hidden</option>
      </select>

      <select id="log-date-filter">
        <option value="today">Today</option>
        <option value="yesterday">Yesterday</option>
        <option value="thisweek" selected>This week</option>
        <option value="lastweek">Last week</option>
        <option value="all">2 weeks</option>
      </select>
      
      <label><input type="checkbox" id="toggle-quest" checked> Quest</label>
      <label><input type="checkbox" id="toggle-pois"> POIs</label>
      <label><input type="checkbox" id="toggle-shapes"> Labels</label>

      <button id="fullscreen-map" title="Toggle map fullscreen">⤢</button>
    </div>
  </div>
</div>

{# Data elements used by JS #}
{{ logs_json|json_script:"logs-data" }}
{{ poi_json|json_script:"poi-data" }}
{{ quest_json|json_script:"quest-data" }}
{{ shape_data|json_script:"shape-data" }}

{% include "daggerwalk/map_marker_popup.html" %}