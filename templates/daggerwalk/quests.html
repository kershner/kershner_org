{% load static %}

{% if current_quest %}
<h4>Current Quest</h4>
<div class="quests-wrapper" style="background-image: url('{% static 'img/daggerwalk/scroll.png' %}');">
  <article class="quest-card" aria-labelledby="quest-title">
    <div class="quest-title-wrapper">
      <h1 id="quest-title" class="quest-name">{{ current_quest.quest_name }}</h1>
      <a
        title="View {{ current_quest.poi.name }} on the map"
        class="quest-map-link"
        href="{% url 'quest' %}"
      >Map</a>
    </div>

    <div class="quest-info">
      <div class="quest-giver">
        <img
          src="{{ current_quest.quest_giver_img_url }}"
          alt="Quest giver: {{ current_quest.quest_giver_name }}"
          loading="lazy"
        />
      </div>

      <div class="quest-desc-wrapper">
        <div class="quest-desc">
          <p>"{{ current_quest.description }}"</p>
          <span class="quest-giver-name">- {{ current_quest.quest_giver_name }}</span>
        </div>

        <div class="quest-meta">
          <p class="quest-started">
            Started 
            {% if current_quest.created_at.date == today %}
              today
            {% elif current_quest.created_at.date == yesterday %}
              yesterday
            {% else %}
              {{ current_quest.created_at|timesince }} ago
            {% endif %}
          </p>
          
          <p class="quest-xp">{{ current_quest.xp }} XP</p>
        </div>
      </div>
    </div>
  </article>
</div>

<section class="faq" aria-labelledby="faq-title">
  <h2 id="faq-title">Quests FAQ</h2>
  <details open>
    <summary>How do quests and logs work?</summary>
    <p>Every 5 minutes the game sends a log of the current state to the server. Each log records the Walker's location, chat commands, and more. Quests are only checked and updated when a new log arrives.</p>
  </details>

  <details>
    <summary>How do I get credit?</summary>
    <p>Send a chat command during the quest window (from when the quest starts until the log that completes it). If your command appears in one of those logs, you’re credited.</p>
  </details>

  <details>
    <summary>What happens when a quest completes?</summary>
    <p>When a log matches the quest’s target POI, the quest is marked completed, all qualifying users are awarded, and a new quest immediately begins.</p>
  </details>
</section>

{% else %}
  <p>The Walker is not currently on a quest.</p>
{% endif %}

{% if leaderboard_top10 %}
<h4>Leaderboard</h4>
<table class="styled-table">
  <thead>
    <tr>
      <th>User</th>
      <th>Total XP</th>
    </tr>
  </thead>
  <tbody>
    {% for row in leaderboard_top10 %}
      <tr>
        <td>
          <a href="https://www.twitch.tv/{{ row.twitch_username }}" target="_blank" rel="noopener">
            {{ row.twitch_username }}
          </a>
        </td>
        <td><strong>{{ row.total_xp }}</strong></td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}