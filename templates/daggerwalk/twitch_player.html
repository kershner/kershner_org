<script src="https://embed.twitch.tv/embed/v1.js"></script>

<div id="twitch-container">
  <div id="player-and-chat">
    <div id="twitch-embed"></div>

    <div id="chat-panel" aria-hidden="false">
      <iframe id="twitch-chat" frameborder="0" scrolling="no"></iframe>
    </div>
  </div>
</div>

<script type="text/javascript">
  const CHANNEL = "daggerwalk";
  const PARENT = window.location.hostname;

  // Init player
  const player = new Twitch.Embed("twitch-embed", {
    channel: CHANNEL,
    parent: [PARENT], 
    width: "100%",
    height: "100%",
    layout: "video",
    theme: "dark"
  });

  // Init chat iframe
  const chatSrc =
  `https://www.twitch.tv/embed/${encodeURIComponent(CHANNEL)}/chat` +
  `?parent=${encodeURIComponent(PARENT)}` +
  `&darkpopout`
  const chatFrame = document.getElementById("twitch-chat");
  chatFrame.src = chatSrc;

  // Toggle chat
  const panel = document.getElementById("chat-panel");
  const btn = document.getElementById("toggle-chat");

  // Restore last state
  const saved = localStorage.getItem("chatHidden") === "true";
  setChatHidden(saved);

  btn.addEventListener("click", () => {
    const hidden = panel.getAttribute("aria-hidden") === "true";
    setChatHidden(!hidden);
  });

  function setChatHidden(hidden) {
    panel.setAttribute("aria-hidden", hidden ? "true" : "false")
    btn.setAttribute("aria-pressed", hidden ? "true" : "false")
    btn.textContent = hidden ? "Show Chat" : "Hide Chat"
    localStorage.setItem("chatHidden", String(hidden))

    document.getElementById("player-and-chat")
      .classList.toggle("chat-hidden", hidden)
  }
</script>
