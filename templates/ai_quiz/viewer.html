{% extends 'ai_quiz/base.html' %}

{% block header %}
    {{ block.super }}
    <p class="blurb">
        Generated by <a href="https://en.wikipedia.org/wiki/OpenAI">OpenAI</a>
        <br>
        <em>{{ quiz.created }}</em>
    </p>
    {% include "ai_quiz/includes/quiz_controls.html" %}
{% endblock %}

{% block content %}
{% if not quiz.processed and not quiz.error %}
    <p class="blurb">
        Your quiz is being generated!  This page will automatically refresh when it's ready.
    </p>
    <div class="loading-spinner">
      <div class="spinner"></div>
    </div>
{% elif quiz.error %}
    <p class="blurb">Unfortunately, something went wrong processing this quiz.  Please try another.</p>
{% endif %}

{% if quiz.processed %}
    {% for question in quiz.get_questions %}
    <div class="question">
        <div class="question-text">{{ question.text }}</div>

        <div class="answer obscured"  title="Click to reveal answer">
            <div class="answer-text">
                {{ question.get_answer.text }}

                <div class="answer-source">{{ question.get_answer.get_source_html }}</div>
            </div>
        </div>
    </div>
    {% endfor %}

    {% if request.user.is_superuser %}
    <ul class="cost-info">
        {% for key, value in quiz.get_cost_info.items %}
        <li>
            <strong>{{ key }}</strong>: {{ value }}
        </li>
        {% endfor %}
    </ul>
    {% endif %}
{% endif %}

{% include 'ai_quiz/widgets/variation_quizes.html' %}
{% endblock %}

{% block extra_js %}
    {% if not quiz.error and not quiz.processed %}
    <script type="text/javascript">
        aiQuiz.aiQuizViewerUrl = '{% url 'view-ai-quiz' quiz_id=quiz.uniq_id %}';
        aiQuiz.checkQuizProcessed();
    </script>
    {% endif %}
{% endblock %}