:root
  --background-color: #000000
  --text-color: #FFFFFF
  --alternate-dark: #1A1A1A
  --accent-color: #F2E530

$error: #ff6b6b
$border-width: 0.3rem
$border-radius: 0.2rem

$primary-font-family: Helvetica, Arial, sans-serif
$secondary-font-family: Georgia, serif

$mobile-breakpoint: 768px

=button-style
  cursor: pointer
  color: var(--accent-color)
  padding: 0.25rem 0.5rem
  border: 1px solid var(--accent-color)
  border-radius: $border-radius
  font-size: 0.75rem
  font-weight: bold
  text-decoration: none

  &:hover,
  &.active
    background-color: var(--accent-color)
    color: var(--background-color)

// Mixin for pulse animation
@mixin pulse-animation($scale: 1.5, $opacity: 1.0, $duration: 1.5s)
  animation: pulse $duration infinite ease-in-out

  @keyframes pulse
    0%
      transform: translate(-50%, -50%) scale(1)
    50%
      transform: translate(-50%, -50%) scale($scale)
    100%
      transform: translate(-50%, -50%) scale(1)

button
  cursor: pointer

body 
  margin: 0
  padding: 0
  font-family: $primary-font-family
  background: var(--background-color)
  color: var(--text-color)
  overflow-x: hidden

  &.light
    --background-color: #FFFFFF
    --text-color: #333333
    --alternate-dark: #F5F5F5

    .top-row
      .logo-wrapper img
        -webkit-mask-image: linear-gradient(to bottom, black 30%, transparent 70%)
        mask-image: linear-gradient(to bottom, black 30%, transparent 70%)
    
  &.dark
    --background-color: #000000
    --text-color: #FFFFFF
    --alternate-dark: #1A1A1A

hr
  margin: 2rem 0
  height: $border-width
  background-color: var(--accent-color)
  border-radius: $border-radius
  border: none

a
  color: var(--accent-color)
  text-decoration: none
  text-decoration: underline
  text-decoration-thickness: 0.1rem
  font-weight: bold

.secondary-font
  font-family: $secondary-font-family
  
.text-highlight
  color: var(--accent-color)

.less-margin
  margin: 0.25rem 0

.extra-margin-bottom
  margin-bottom: 4rem

.view-container 
  position: relative
  display: flex
  flex-direction: column

.view-title
  font-family: $secondary-font-family
  margin: 0.5rem
  margin-left: 1rem
  
.view-subtitle
  margin: 0.5rem
  margin-top: -0.5rem
  margin-left: 1rem
  font-style: italic
  font-weight: normal
  font-size: 1.5rem
  color: var(--accent-color)

.map-container
  height: 55vw
  overflow: hidden
  
  #filters
    display: flex
    align-items: center
    gap: 0.5rem
    padding: 0.25rem 0
    padding-left: 0.5rem
    background: var(--background-color)
    color: var(--text-color)

    label
      top: 0
      margin: 0
      padding: 0

    input
      display: unset
    button
      all: unset
      +button-style
    
  #map
    height: 100%
    margin: 0
    background: var(--background-color)

  /* Base cluster */
  .custom-cluster
    div
      width: 36px
      height: 36px
      border-radius: 50%
      display: flex
      align-items: center
      justify-content: center
      font-weight: bold

  /* POI and Log cluster types */
  .poi-cluster
    .cluster-circle
      color: #fff
      flex-direction: column

  .log-cluster
    .cluster-icon
      border: 2px solid var(--accent-color)
      background: url('/static/img/daggerwalk/Daggerwalk.ico') center/cover no-repeat
      filter: grayscale(90%)
    &.latest-log
      .cluster-icon
        filter: none

  /* Pin + count in POI clusters */
  .cluster-emoji
    font-size: 14px
    line-height: 1

  .cluster-count
    font-size: 12px

  /* Highlight for latest cluster or marker */
  .log-marker
    div
      width: 6px
      height: 6px
      background: var(--accent-color)
      border-radius: 50%

    &.latest-log
      div
        width: 12px
        height: 12px
        @include pulse-animation(2, 1, 1.8s)
    
  .quest-marker
  .poi-marker
  .latest-log
    div
      @include pulse-animation(1.8, 1, 1.8s)

  /* Province name labels */
  .region-label
    color: #fff
    font-weight: bold
    text-shadow: 0 0 4px #000
    font-size: 14px
    text-align: center
    pointer-events: none

  /* Ensure markers stay above overlay */
  .leaflet-marker-pane,
  .leaflet-shadow-pane
    z-index: 600

.hidden 
  display: none !important

.error 
  color: $error

.top-row
  display: flex
  justify-content: space-between

  img
    position: absolute
    top: 0
    right: 0
    width: 5rem
    -webkit-mask-image: linear-gradient(to bottom, black 30%, transparent 100%)
    mask-image: linear-gradient(to bottom, black 30%, transparent 100%)
  
  .menu-container
    display: flex
    position: relative
    top: 2.75rem
    gap: 0.5rem
    z-index: 999

    &.open
      .menu-toggle
        color: var(--background-color)
        background: var(--accent-color)
        border-radius: $border-radius $border-radius 0 0 

    .menu-toggle
      display: flex
      align-items: center
      gap: 0.5rem
      padding-bottom: 0.2rem
      cursor: pointer
      color: var(--accent-color)
      background: unset
      border-color: transparent
      border-radius: $border-radius
      
      &:hover
        color: var(--background-color)
        background: var(--accent-color)

      .title
        margin: 0
        font-family: $secondary-font-family
        font-weight: bold
        text-decoration: underline
        text-decoration-thickness: 2px
        
      .menu-icon
        font-size: 1.25rem
        line-height: 1.25rem
    
    .site-menu
      position: relative
      padding-right: 0.5rem

      .site-controls
        position: absolute
        top: 1.7rem
        right: 0.5rem
        padding: 0.25rem 0.5rem
        background-color: var(--background-color)
        border: $border-width solid var(--accent-color)
        border-radius: $border-radius

        .site-control-row
          display: flex
          padding: 0.5rem
          border-bottom: 1px solid var(--alternate-dark)
          &:last-of-type
            border-bottom: none

          .site-control-label
            text-align: right
            padding-right: 1rem
            white-space: nowrap

          .site-control-input
            display: flex
            gap: 0.75rem
            align-items: center

          button
            all: unset
            +button-style
            width: 100%
            text-align: center
        
          input,
          select,
          button
            cursor: pointer

            &[type="color"]
              margin-top: 0.25rem

          .site-control-checkbox
            margin-right: 0.5rem
            cursor: pointer
            &:last-of-type
              margin-right: 0

          label
            cursor: pointer !important
            color: var(--accent-color)
            font-weight: bold
              
.tabs
  input
    display: none

  label
    padding: 0.25rem 0.5rem
    cursor: pointer
    display: inline-block
    position: relative
    z-index: 1

    @media (max-width: $mobile-breakpoint)
      font-size: 0.8rem

    &::after
      content: ''
      display: block
      width: 0
      height: $border-width
      background: var(--accent-color)
      position: absolute
      bottom: -$border-width
      left: 50%
      transform: translateX(-50%)
      border-radius: $border-radius

  .tab-content
    display: none
    padding-top: 1.5rem

  // "Selected" styles
  @for $i from 1 through 5
    // tab label
    input:nth-of-type(#{$i}):checked ~ label:nth-of-type(#{$i})
      font-weight: bold
      color: var(--text-color)

      &::after
        width: 100%

    // tab content
    input:nth-of-type(#{$i}):checked ~ .tab-content:nth-of-type(#{$i})
      display: block

#twitch-container
  width: 100%
  margin: 0

#player-and-chat
  display: flex
  align-items: stretch

  &.chat-hidden
    display: block

    #chat-panel
      display: none   // remove from flow completely when hidden

#player-and-chat
  display: flex
  align-items: stretch

  &.chat-hidden
    display: block

    #chat-panel
      display: none

#twitch-embed
  flex: 1 1 auto
  min-width: 0
  width: 100%
  aspect-ratio: 16 / 9

  iframe
    display: block
    width: 100%
    height: 100%

#chat-panel
  width: 30rem
  max-width: 40vw
  overflow: hidden
  transition: width .2s ease, margin-left .2s ease, opacity .2s ease
  height: auto

#twitch-chat
  display: block
  width: 100%
  height: 100%
  border: 0

@media (max-width: 64rem)
  #player-and-chat
    display: block

  #chat-panel
    width: 100%
    max-width: none
    margin-left: 0
    height: 60dvh    // good touch target size on phones

.current-status
  padding: 1rem
  border-top: $border-width solid var(--accent-color)
  
  h2
    margin: 0
    font-family: $secondary-font-family
    color: var(--accent-color)
    display: flex
    flex-wrap: wrap
    column-gap: 0.25rem

    span
      white-space: normal
      
      &:last-of-type
        font-weight: normal

  p
    margin: 0

  .time-string
    display: block
    font-size: 1.2rem
    font-weight: bold

.stats-content
  display: flex
  flex-direction: column

  h4
    width: fit-content

  select
    padding: .25rem
    cursor: pointer
    font-size: 1.1rem

  #reload-stats-btn
    all: unset
    +button-style

  .stats-data-wrapper
    display: inline-flex
    flex-direction: column
    gap: 0.75rem
    padding-top: 1.5rem

    .stats-data-item
      font-size: 1.2rem
      dt
        font-weight: bold
      dd
        margin-left: 0

      .stats-date-range
        display: flex
        gap: 1rem

        .stats-date-range-item
          .stats-date-range-date
            font-family: $secondary-font-family
          .stats-date-range-season
            font-size: 0.9rem
            font-family: $secondary-font-family
            font-style: italic
    
    .stat-poi
        display: flex
        gap: 0.5rem

        div
          display: flex
          flex-direction: column

.main-tabs
  label
    top: 1rem

    &:first-of-type
      margin-left: 1rem

.about-tabs
  padding: 0.5rem 1rem
  max-width: 40rem

  h2
    margin: 0
    font-family: $secondary-font-family
    color: var(--accent-color)
    font-size: 2rem

  h4
    display: inline-block
    margin: 1rem 0
    margin-bottom: 0
    font-size: 1rem
    padding: 0.5rem 1rem
    border-left: $border-width solid var(--accent-color)
    border-radius: $border-radius
    background: var(--alternate-dark)

  h5
    margin: 1rem 0
    display: block
    font-family: $secondary-font-family
    font-weight: bold
    font-size: 1rem
  
  ul
    margin: 1rem 0

    li
      margin: 0.2rem 0

  .about-img
    border: 0.2rem solid var(--accent-color)
    margin: 1rem 0
    border-radius: $border-radius

    &.no-border
      border: none

    img
      width: 100%

.styled-table
  width: 100%
  border-collapse: collapse
  table-layout: fixed

  th, td
    padding: 10px
    text-align: left
  th
    border-bottom: 0.2rem solid var(--accent-color)
    color: var(--accent-color)
  tr:nth-child(even)
    background: var(--alternate-dark)
  tr:hover
    :not(th)  
      background: var(--accent-color)
      color: var(--background-color)
      
      a
        border-color: var(--background-color)

.twitch-cmds-table
  td
    overflow-wrap: break-word

.commands-table
  td:first-of-type
    font-weight: bold

.songs-table
  a
    +button-style
    padding: 0.25rem 0.35rem
    margin-left: 0.5rem
    font-size: 0.7rem

#leaderboard
  :is(th, td):first-child
    width: 5%
  :is(th, td):nth-child(2),
  :is(th, td):nth-child(3)
    width: 50%

#pager
  margin-top: 1rem
  
  button
    all: unset
    +button-style
  span
    margin: 0 0.25rem
    font-size: 0.8rem

blockquote
  padding: 1rem
  border-left: $border-width solid var(--accent-color)
  border-radius: $border-radius
  background: var(--alternate-dark)
  margin: 1rem 0
  width: fit-content

  p
    margin: 0
    font-family: $secondary-font-family

  cite
    display: block
    margin-top: 0.5rem
    font-size: 0.9rem
    font-style: italic

.gallery-container
  .images
    max-width: 15rem
    display: flex
    border: $border-width solid var(--accent-color)
    border-radius: $border-radius

    a
      display: flex
      align-items: center
      
      &:hover
        opacity: 0.8
      
      img
        width: 100%
      
  .cite
    display: block
    font-size: 0.8rem
    margin-top: 5px

.paragraph
  text-indent: -0.75em
  padding-left: calc(1.25rem)

  &::first-letter
    font-size: 1.25em
    color: var(--accent-color)
    font-weight: bold
    font-family: $secondary-font-family

.schedule-block
  border-radius: $border-radius
  margin: 1rem 0
  text-align: center
  
  h1
    margin-bottom: 1.5rem
    color: var(--accent-color)
    font-size: 1.5rem
    font-family: $secondary-font-family
  
  .schedule-time
    font-size: 1.25rem
    margin-bottom: 1rem
    background-color: var(--alternate-dark)
    padding: 1rem
    border-radius: $border-radius
    border-left: $border-width solid var(--accent-color)
  
  .schedule-days
    font-size: 1rem
    color: var(--text-color)
    margin-top: 1.5rem

    span
      font-weight: bold
  
  .highlight
    color: var(--accent-color)
    font-weight: bold

.table-filter-input
  display: unset !important
  width: 15rem
  padding: 0.5rem
  border: 0
  border-radius: $border-radius

.footer
  padding: 0 1rem
  display: flex
  gap: 0.25rem
  margin: 0.25rem 0

  .footer-btn
    +button-style

  .dropdown
    position: relative

  .dropdown-content
    display: none
    position: absolute
    margin-top: 0.25rem
    left: 0
    padding: 0.5rem
    background-color: var(--accent-color)
    width: max-content
    z-index: 2
    border-radius: $border-radius

    a
      color: var(--background-color)
      font-size: 0.8rem

  .dropdown[open] .dropdown-content
    display: flex
    flex-direction: column
    gap: 0.5rem

$quests-text-color: darken(#333333, 10%)

.quests-wrapper
  display: block
  position: relative
  margin-top: 0.5rem
  padding: 2.5rem 1.5rem
  background-repeat: no-repeat
  background-position: center top
  background-size: 100% 100%
  color: $quests-text-color

  .quest-card
    display: flex
    flex-direction: column
    gap: 0.25rem

  .quest-title-wrapper
    display: flex
    gap: 1rem

  .quest-name
    margin: 0
    font-family: $secondary-font-family
    font-size: 1.3rem
    @media (max-width: $mobile-breakpoint)
      font-size: 1.1rem

  .quest-map-link
    +button-style
    align-self: flex-start
    color: $quests-text-color
    border-color: $quests-text-color

    &:hover
      background-color: $quests-text-color
      color: #FFF

  .quest-info
    display: flex
    gap: 1rem
    margin-top: 0.5rem

  .quest-giver
    width: 8rem

    img
      width: 100%
      border-radius: $border-radius

  .quest-desc-wrapper
    display: flex
    flex-direction: column

  .quest-desc 
    display: flex
    flex-direction: column
    gap: 0.5rem

    p
      margin: 0
      font-family: $secondary-font-family
      font-size: 1.2rem

  .quest-giver-name
    font-style: italic
    padding-left: 1rem

  .quest-meta
    display: flex
    gap: 1rem
    align-self: flex-end
    align-items: baseline

    .quest-dates
      display: flex
      gap: 1rem
      font-size: 0.8rem
      font-style: italic

      .quest-completed
        display: flex
        flex-direction: column
        align-items: flex-end

        .quest-duration
          font-weight: bold

    .quest-xp
      font-weight: bold
      font-size: 1.3rem
      font-family: $secondary-font-family

.faq
  padding: 0.5rem 0

  h2
    margin: 0 0 0.5rem
    font-family: $secondary-font-family
    color: var(--accent-color)
    font-size: 2rem

  details
    background: var(--alternate-dark)
    border-radius: $border-radius
    padding: 0.75rem 1rem
    margin: 0.5rem 0

    summary
      list-style: none
      cursor: pointer
      font-weight: bold
      color: var(--text-color)
      position: relative
      padding-right: 1.25rem

      // hide default marker
      &::-webkit-details-marker
        display: none

      // custom caret
      &::after
        content: "â–¸"
        position: absolute
        right: 0
        top: 0
        transform: translateY(0.1rem) rotate(0deg)
        transition: transform .2s ease
        color: var(--accent-color)

      &:hover
        opacity: 0.9

      &:focus
        outline: 2px solid var(--accent-color)
        outline-offset: 2px

    &[open] summary::after
      transform: translateY(0.1rem) rotate(90deg)

    p
      margin: 0.5rem 0 0
      font-family: $secondary-font-family
      line-height: 1.5
  
.previous-quests-table
  .quests-wrapper
    width: 100%
    color: var(--text-color)
    padding: 0 0.5rem

    .quest-giver
      width: 6rem

    .quest-desc-wrapper
      flex-grow: 1
      padding-right: 1rem 

    .quest-map-link
      display: none
